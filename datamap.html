

<!DOCTYPE html>
<html lang="ja">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>datamap</title>

	<!-- ================================================== -->
	<!-- ▼D3/DC/Crossfilterファイル読み込み -->
	<!-- ================================================== -->
  <script type="text/javascript" src="../d3.github.com/d3.v3.min.js"></script>
  <script type="text/javascript" src="../crossfilter/crossfilter.js"></script>
  <script type="text/javascript" src="../dc.js/dc.min.js"></script>
  <!-- <script type="text/javascript" src="../dc.js/src/bubble-overlay.js"></script> -->
  <link rel="stylesheet" type="text/css" href="../dc.js/dc.css"/>

  <!-- ================================================== -->
  <!-- ▼topojson/datamapsファイル読み込み -->
  <!-- ================================================== -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  <script src="../datamaps/dist/datamaps.world.hires.min.js"></script>

	<!-- ================================================== -->
	<!-- ▼jQuery/Semantic UIファイル読み込み -->
	<!-- ================================================== -->
	<script type="text/javascript" src="../jquery-dist/dist/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../Semantic-UI/dist/semantic.min.css">
	<script type="text/javascript" src="../Semantic-UI/dist/semantic.min.js"></script>
	<script type="text/javascript" src="../UI-Dropdown/dropdown.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../UI-Dropdown/dropdown.min.css">
	<script type="text/javascript" src="../UI-Popup/popup.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../UI-Popup/popup.min.css">

</head>
<body>
  <!--first row-->
  <div class="ui grid" style="margin:0 0 0 0;">
    <div class="eight wide column">
      <div id="chart_1">
      </div>
    </div>
    <div class="eight wide column">
      <div id="chart_2">
      </div>
			<div id="chart_3">
			</div>
    </div>
  </div>
	<!--second row-->
	<div class="ui grid" style="margin:0 0 0 0;">
		<div class="eight wide column">
			<div id="chart_4">
			</div>
		</div>
		<div class="eight wide column">
			<div id="chart_5">
			</div>
		</div>
	</div>

  <script>
      // var data = ([
      //   {date: "2011-11-14T16:17:54Z", longitude: 135, latitude: 30, radius: 1, type: "tab"},
      //   {date: "2011-11-14T16:20:19Z", longitude: 137, latitude: 25, radius: 2, type: "tab"},
      //   {date: "2011-11-14T16:28:54Z", longitude: 139, latitude: 20, radius: 3, type: "visa"},
      //   {date: "2011-11-14T16:30:43Z", longitude: 140, latitude: 25, radius: 4, type: "tab"},
      //   {date: "2011-11-14T16:48:46Z", longitude: 142, latitude: 30, radius: 5, type: "tab"},
      //   {date: "2011-11-14T16:53:41Z", longitude: 144, latitude: 35, radius: 6, type: "tab"},
      //   {date: "2011-11-14T16:54:06Z", longitude: 146, latitude: 40, radius: 5, type: "cash"},
      //   {date: "2011-11-14T16:58:03Z", longitude: 130, latitude: 50, radius: 4, type: "tab"},
      //   {date: "2011-11-14T17:07:21Z", longitude: 125, latitude: 45, radius: 3, type: "tab"},
      //   {date: "2011-11-14T17:22:59Z", longitude: 120, latitude: 40, radius: 2, type: "tab"},
      //   {date: "2011-11-14T17:25:45Z", longitude: 150, latitude: 25, radius: 10, type: "cash"},
      //   {date: "2011-11-14T17:29:52Z", longitude: 155, latitude: 30, radius: 7, type: "visa"}
      // ]);



      d3.tsv("data/earthquakes_sample.csv", function(data) {
				//magnitude --> radius
				Object.keys(data[0]).forEach(function (key) {
					for(var i = 0 ; i<data.length ; i++ ){
						data[i]["radius"]=data[i]["magnitude"]*10
					}
				});

				// Object.keys(data[0]).forEach(function (key) {
				// 	for(var i = 0 ; i<data.length ; i++ ){
				// 		console.log(key + ":" + data[i][key]);
				// 	}
				// });
      	plotbubble(data);
      });

      function plotbubble(data){
				//draw map
				var map = new Datamap({
					element : document.getElementById('chart_1'),
					scope   : "world",
					// Zoom in Japan
					setProjection: function(element) {
						var projection = d3.geo.equirectangular()
							.center([170,-45])
							.rotate([0, 0])
							.scale(1200)
							.translate([element.offsetWidth / 2, element.offsetHeight / 2]);
						var path = d3.geo.path()
							.projection(projection);

						return {path: path, projection: projection};
					},
					// projection: 'orthographic', //style of projection to be used. try 'mercator','equirectangular','orthographic'
					// projectionConfig: {
					//   rotation: [-150,0]
					// },
					height: 500, //if not null, datamaps will grab the height of 'element'
					width: 500, //if not null, datamaps will grab the width of 'element'
					responsive: false, //if true, call `resize()` on the map object when it should adjust it's size
					fills: {
						defaultFill: '#6f6f6f' //the keys in this object map to the "fillKey" of [data] or [bubbles]
					},
					geographyConfig: {
						dataUrl: null, //if not null, datamaps will fetch the map JSON (currently only supports topojson)
						hideAntarctica: true,
						borderWidth: 1,
						borderOpacity: 1,
						borderColor: '#FFFFFF',
					},
					bubblesConfig: {
		        borderWidth: 1,
		        borderOpacity: 1,
		        borderColor: '#FFFFFF',
		        popupOnHover: true, // True to show the popup while hovering
		        radius: null,
		        // popupTemplate: function(geography, data) { // This function should just return a string
		        //   return '<div class="hoverinfo"><strong>' + data.name + '</strong></div>';
		        // },
		        fillOpacity: 0.75,
		        animate: true,
		        highlightOnHover: true,
		        highlightFillColor: '#FC8D59',
		        highlightBorderColor: 'rgba(250, 15, 160, 0.2)',
		        highlightBorderWidth: 2,
		        highlightBorderOpacity: 1,
		        highlightFillOpacity: 0.85,
		        exitDelay: 100, // Milliseconds
		        key: JSON.stringify
    			}
				});

				var chart_width=500;
				var chart_height=500;
        cf = crossfilter(data);
        console.log(data);

        var dim_radius = cf.dimension(function(d) {
            return [d.radius];
        });
				var dim_depth = cf.dimension(function(d) {
						return [d.depth];
				});
				var dim_magnitude = cf.dimension(function(d) {
						return [d.magnitude];
				});

				var barChart_depth = dc.barChart('#chart_2');
				barChart_depth
					.width(chart_width)
					.height(chart_height/2)
					.dimension(dim_depth)
					.group(dim_depth.group().reduceCount())
					.transitionDuration(500)
					.centerBar(true)
					.gap(79)
					.x(d3.scale.linear().domain([0,100]))
					//.y(d3.scale.linear().domain([min_y,max_y]))
					.renderHorizontalGridLines(true)
					.renderVerticalGridLines(true)
					.yAxisLabel('Counts')
					.xAxisLabel('depth [km]')
					.xAxis().ticks(5)
					//.yAxis().ticks(5)
					//.elasticY(true);
					//.xAxis().tickFormat();
				barChart_depth
					.render()
					.on('filtered.monitor', function(chart, filter) {
    				//filter applied
						map.bubbles(
							dim_depth.top(Infinity),{
							popupTemplate: function(geo, data) {
								return '<div class="hoverinfo">(Lat,Lon):(' + data.latitude + ' , ' + data.longitude + ')'
							}
						});
					});

				var barChart_magnitude = dc.barChart('#chart_3');
				barChart_magnitude
					.width(chart_width)
					.height(chart_height/2)
					.dimension(dim_magnitude)
					.group(dim_magnitude.group().reduceCount())
					.transitionDuration(500)
					.centerBar(true)
					.gap(79)
					.x(d3.scale.linear().domain([0,10]))
					//.y(d3.scale.linear().domain([min_y,max_y]))
					.renderHorizontalGridLines(true)
					.renderVerticalGridLines(true)
					.yAxisLabel('Counts')
					.xAxisLabel('Magnitude')
					.xAxis().ticks(5)
					//.yAxis().ticks(5)
					//.elasticY(true);
					//.xAxis().tickFormat();
				barChart_magnitude
					.render()
					.on('filtered.monitor', function(chart, filter) {
    				//filter applied
						map.bubbles(
							dim_magnitude.top(Infinity),{
							popupTemplate: function(geo, data) {
								return '<div class="hoverinfo">(Lat,Lon):(' + data.latitude + ' , ' + data.longitude + ')'
							}
						});
					});


				// var pieChart = dc.pieChart('#chart_4');
				//
				// 	pieChart
				// 		.width(chart_width)
				// 		.height(chart_height)
				// 		//margins({top: 10, right: 50, bottom: 30, left: 40})
				// 		.cx(chart_width/2)
				// 		.cy(chart_height/2)
				// 		.innerRadius(chart_width/10)
				// 		.slicesCap(5)    // 上位3種のみ表示し、後はその他とする
				// 		.dimension(dim_radius)
				// 		.group(dim_radius.group().reduceCount())
				// 		.transitionDuration(500)
				// 		.ordering(function(t){
				// 		return -t.value;
				// 		})
				// 		.legend(dc.legend())
				// 		.label(function(d) {
				// 			//console.log('label', d);
				// 			return d.key + ': ' + d.value;
				// 		})
				// 		.render();
				// 	pieChart.on('filtered.monitor', function(chart, filter) {
    		// 		//filter applied
				// 		map.bubbles(
				// 			dim_radius.top(Infinity),{
				// 			popupTemplate: function(geo, data) {
				// 				return '<div class="hoverinfo">(Lat,Lon):(' + data.latitude + ' , ' + data.longitude + ')'
				// 			}
				// 		});
				// 	});

      }


  </script>
</body>

</html>
